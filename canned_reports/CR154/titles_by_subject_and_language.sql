joanne's revised code here
